<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="VirtIO guest drivers."><title>virtio_drivers - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-cf3c48c1.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="virtio_drivers" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0-nightly (854f22563 2025-01-31)" data-channel="nightly" data-search-js="search-2d513d54.js" data-settings-js="settings-6dad6058.js" ><script src="../static.files/storage-302de22f.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-9b5d7e41.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../virtio_drivers/index.html">virtio_<wbr>drivers</a><span class="version">0.7.1</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#usage" title="Usage">Usage</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>virtio_drivers</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/virtio_drivers/lib.rs.html#1-147">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>VirtIO guest drivers.</p>
<p>These drivers can be used by bare-metal code (such as a bootloader or OS kernel) running in a VM
to interact with VirtIO devices provided by the VMM (such as QEMU or crosvm).</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2>
<p>You must first implement the <a href="trait.Hal.html" title="trait virtio_drivers::Hal"><code>Hal</code></a> trait, to allocate DMA regions and translate between
physical addresses (as seen by devices) and virtual addresses (as seen by your program). You can
then construct the appropriate transport for the VirtIO device, e.g. for an MMIO device (perhaps
discovered from the device tree):</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>core::ptr::NonNull;
<span class="kw">use </span>virtio_drivers::transport::mmio::{MmioTransport, VirtIOHeader};

<span class="kw">let </span>header = NonNull::new(mmio_device_address <span class="kw">as </span><span class="kw-2">*mut </span>VirtIOHeader).unwrap();
<span class="kw">let </span>transport = <span class="kw">unsafe </span>{ MmioTransport::new(header) }.unwrap();</code></pre></div>
<p>You can then check what kind of VirtIO device it is and construct the appropriate driver:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>virtio_drivers::{
    device::console::VirtIOConsole,
    transport::{mmio::MmioTransport, DeviceType, Transport},
};

<span class="kw">if </span>transport.device_type() == DeviceType::Console {
    <span class="kw">let </span><span class="kw-2">mut </span>console = VirtIOConsole::&lt;HalImpl, <span class="kw">_</span>&gt;::new(transport).unwrap();
    <span class="comment">// Send a byte to the console.
    </span>console.send(<span class="string">b'H'</span>).unwrap();
}</code></pre></div>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="device/index.html" title="mod virtio_drivers::device">device</a></dt><dd>Drivers for specific VirtIO devices.</dd><dt><a class="mod" href="transport/index.html" title="mod virtio_drivers::transport">transport</a></dt><dd>VirtIO transports.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.BufferDirection.html" title="enum virtio_drivers::BufferDirection">Buffer<wbr>Direction</a></dt><dd>The direction in which a buffer is passed.</dd><dt><a class="enum" href="enum.Error.html" title="enum virtio_drivers::Error">Error</a></dt><dd>The error type of VirtIO drivers.</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.PAGE_SIZE.html" title="constant virtio_drivers::PAGE_SIZE">PAGE_<wbr>SIZE</a></dt><dd>The page size in bytes supported by the library (4 KiB).</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.Hal.html" title="trait virtio_drivers::Hal">Hal</a></dt><dd>The interface which a particular hardware implementation must implement.</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><dl class="item-table"><dt><a class="type" href="type.PhysAddr.html" title="type virtio_drivers::PhysAddr">Phys<wbr>Addr</a></dt><dd>A physical address as used for virtio.</dd><dt><a class="type" href="type.Result.html" title="type virtio_drivers::Result">Result</a></dt><dd>The type returned by driver methods.</dd></dl></section></div></main></body></html>